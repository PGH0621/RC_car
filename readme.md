# 📌 [임베디드통신시스템] RC카 프로젝트

## 📖 소개

이 프로젝트는 [임베디드통신시스템] 강의의 일환으로, RC카에 아두이노와 라즈베리파이를 활용한 자율주행 및 수동조종 기능을 구현한 과제입니다. RC카는 조종기(AT9)로 수동 조작이 가능하며, 라즈베리파이 카메라를 이용한 라인 트레이싱을 통해 자율주행 모드로 전환할 수 있습니다.

---

## 📝 과제 설명
1. 송수신기, 조종기를 이용하여 RC카 제어하기
2. 라즈베리파이와 카메라를 이용하여 라인트레이서 알고리즘 구현하기
3. 아두이노와 DC모터, 서보모터 연결 후 ESC의 PWM 신호 입력값 제어하기
4. PWM 신호 범위 조절하여 RC카의 속도를 적절하게 조정하고, 라인트레이서 트랙에서 자율주행 구현하기
5. LED를 이용하여 좌회전, 우회전, 후진 시에 불빛 들어오도록 하기


## 📢 구현 설명
- 수신기 CH1, CH2, CH5 채널을 이용하여 아두이노가 PWM 신호를 수신하고 ESC와 서보모터를 제어합니다.
- CH5(SWD 스위치)를 통해 수동/자율 모드를 전환합니다.
- 자율주행 모드에서는 라즈베리파이가 PiCamera2로 라인을 인식하고 편차(deviation)를 계산하여 시리얼로 아두이노에 전송합니다.
- 아두이노는 이 편차 값을 이용해 조향 각도를 조정합니다.
- RC카의 컨셉을 경찰차로 하여, 삼색 LED와 스피커를 추가하였습니다. 삼색 LED를 통해 빨강, 파랑 싸이렌 색을 구현하였고 아두이노 스피커를 이용해 소리를 구현하였습니다. (싸이렌 - SWB, 소리 - SWE)

---

## 📌 핀 매핑 테이블

| 핀 번호 | 채널 | 용도               | 연결 대상           |
|---------|-------|--------------------|----------------------|
| 2       | ESC   | 전진/후진 제어     | ESC                  |
| 3       | SERVO | 좌/우 조향 제어    | 서보 모터            |
| 7       | CH1   | 속도 입력          | 조종기 수신기 CH1    |
| 8       | CH2   | 조향 입력          | 조종기 수신기 CH2    |
| 10      | CH5   | 모드 전환 스위치   | 조종기 수신기 CH5    |

---

## 🎥 동작 시연 영상

아래 사진을 클릭하면 동작이 시연되는 것을 확인할 수 있습니다.


### 자율주행 모드
https://youtu.be/k9z942Rp7XE?si=IcaTrqKzausCTWcr

### 수동모드
https://youtu.be/tq9EZcV04DQ?si=RJwNqD1kFD56lEQ

---

## 🔩 하드웨어

- 아두이노 UNO
- Raspberry Pi 4 (PiCamera2 장착)
- RC카 섀시 + 4WD
- ESC (전자 속도 컨트롤러)
- 서보모터 (조향용)
- 조종기 수신기 (AT9S)
- 전원 배터리 팩
- USB to TTL 케이블 (라즈베리파이 ↔ 아두이노 연결용)

---

## 💻 소프트웨어

### Arduino (아두이노)

- PWM 신호 수신 (CH1, CH2, CH5)
- 서보 모터 및 ESC 제어
- 시리얼 통신을 통해 라즈베리파이로부터 deviation 값 수신
- 수동/자율 모드 전환 구현

### Raspberry Pi (라즈베리파이)

1️⃣ PiCamera2로 영상을 실시간 캡처  
2️⃣ OpenCV로 라인 검출 (이진화 + ROI 분석)  
3️⃣ 편차(deviation) 계산: 중심선 대비 라인 위치  
4️⃣ 시리얼 통신으로 deviation 값을 아두이노에 전송

> 🔧 자세한 코드는 `Arduino/main.ino`, `RaspberryPi/app.py`에 포함된 주석을 참고하세요.

---

## ⚠️ 주의 & 참고 사항

- 시리얼 포트(`/dev/ttyUSB0`, `/dev/ttyUSB1` 등)는 환경에 따라 변경될 수 있으므로 실제 포트 번호 확인 필요
- 아두이노는 반드시 라즈베리파이와 동일한 GND로 연결해야 안정적인 시리얼 통신 가능
- ESC는 반드시 안전하게 배선 후 테스트할 것
- PiCamera2 설정은 해상도와 포맷을 영상처리 성능에 따라 조절 가능

---

